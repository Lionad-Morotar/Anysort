"use strict";const isDev=()=>"development"===process.env.NODE_ENV,warn=r=>"development"===process.env.NODE_ENV&&console.log(`[WARN] ${r}`),strObj=r=>JSON.stringify(r),isVoid=r=>null==r,getType=r=>isVoid(r)?"void":Object.prototype.toString.call(r).slice(8,-1).toLowerCase(),isFn=r=>"function"===getType(r),notNull=r=>!!r,walk=r=>t=>{const n=r instanceof Array?r.slice(0,r.length):r.split(".");let e=t,o=null;for(;e&&n.length;)o=n.shift(),Object.prototype.hasOwnProperty.call(e,o)||warn(`cant find path "${JSON.stringify(r)}" in ${i=t,JSON.stringify(i)}, skip by default`),e=e[o];var i;return e},config={delim:"-",patched:"__ANYSORT_PATCHED__",autoWrap:!0,autoSort:!0,orders:{number:1,string:2,symbol:3,date:4,object:5,function:6,rest:7,void:8}},getCompareValue={void:r=>null,number:Number,string:String,symbol:r=>r.toString(),date:r=>+r,function:r=>r.name,boolean:r=>!r},sortBySameType=(r,t,n)=>{const e=getCompareValue[r];if(e){const r=e(t),o=e(n);return r===o?0:r<o?-1:1}warn(`cant sort ${t} and ${n}，skip by default`)},sortByDiffType=(r,t)=>r-t<0?-1:1,sortByTypeOrder=(r,t)=>{const n=getType(r),e=getType(t),o=config.orders,i=o[n]||o.rest,a=o[e]||o.rest;if(i&&a)return i===a?sortBySameType(n,r,t):sortByDiffType(i,a);warn(`cant sort ${r} and ${t}，skip by default`)},maping=r=>t=>(n,e)=>t(r(n),r(e)),result=r=>t=>(n,e)=>r(t(n,e));class Sort{constructor(){this.pipeline=[]}register(r,t){r(this,t)}map(r){return this.pipeline.push({_value:r,_type:"maping"}),this}result(r){return this.pipeline.push({_value:r,_type:"result"}),this}seal(){let r=sortByTypeOrder;return this.pipeline.reverse().map((t=>{const{_type:n,_value:e}=t;var o,i;"maping"===n&&(r=(o=e,r=>(t,n)=>r(o(t),o(n)))(r)),"result"===n&&(r=(i=e,r=>(t,n)=>i(r(t,n)))(r))})),r}}const plugins={i:r=>r.map((r=>{if("string"==typeof r)return r.toLowerCase();throw new Error('[ANYSORT] "i" plugin only works on string')})),is:(r,t)=>{if(""!==t)return r.map((r=>r===t));throw new Error('[ANYSORT] "is" plugin needs an arg')},nth:(r,t)=>{if(""!==t)return r.map((r=>{if(r instanceof Array)return r[+t];if("string"==typeof r)return r[+t];throw new Error('[ANYSORT] "nth" plugin only works on string or array')}));throw new Error('[ANYSORT] "nth" plugin need an arg')},all:(r,t)=>r.map((r=>{if(""!==t){if(r instanceof Array)return r.every((r=>String(r)===t));if("string"==typeof r)return r===t;throw new Error('[ANYSORT] "all" plugin only works on string or array')}throw new Error('[ANYSORT] "all" plugin need an arg')})),has:(r,t)=>r.map((r=>{if(""!==t){if(r instanceof Array)return r.some((r=>String(r)===t));if("string"==typeof r)return r.includes(t);throw new Error('[ANYSORT] "has" plugin only works on string or array')}throw new Error('[ANYSORT] "has" plugin need an arg')})),not:(r,t="")=>""!==t?r.map((r=>r!==t)):r.map((r=>!r)),len:(r,t)=>""!==t?r.map((r=>{if(r instanceof Array)return r.length===+t;if("string"==typeof r)return r.length===+t;throw new Error('[ANYSORT] "len" plugin only works on string or array')})):r.map((r=>{if(r instanceof Array)return r.length;if("string"==typeof r)return r.length;throw new Error('[ANYSORT] "len" plugin only works on string or array')})),get:(r,t)=>{if(""!==t)return r.map((n=t,r=>{const t=n instanceof Array?n.slice(0,n.length):n.split(".");let e=r,o=null;for(;e&&t.length;)o=t.shift(),Object.prototype.hasOwnProperty.call(e,o)||warn(`cant find path "${JSON.stringify(n)}" in ${i=r,JSON.stringify(i)}, skip by default`),e=e[o];var i;return e}));throw new Error('[ANYSORT] "get" plugin must have a string argument');var n},reverse:r=>r.result((r=>-r)),rand:r=>r.result((r=>Math.random()<.5?-1:1)),result:r=>r.result((r=>r))};function genSortFnFromStr(r){const t=new Sort;return r.split(config.delim).filter(notNull).map((n=>{const e=n.match(/^([^(]+)(\(([^)]*)\))?$/);if(!e)throw new Error(`[ANYSORT] illegal command: ${r}`);{const[,r,n,o]=e;n?t.register(plugins[r],o):t.register(plugins.get,r)}})),t.seal()}function wrapperProxy(r){if(r[config.patched])throw new Error("[ANYSORT] patched arr cant be wrapped again");let t=null;const n=[];return t=new Proxy(r,{get(r,e){switch(e){case config.patched:return!0;case"apply":return(...t)=>factory(r,...t);default:return Object.prototype.hasOwnProperty.call(plugins,e)?(t="")=>{const o=`${[n.splice(0,n.length).join("."),e].join("-")}(${String(t)})`;return factory(r,o)}:e in r?r[e]:e.includes("_")?(t="")=>{const o=`${[n.splice(0,n.length).join("."),e].join("-").replace("_","()-")}(${String(t)})`;return factory(r,o)}:(n.push(e),t)}}})}function genFactory(){return(r,...t)=>{const n=t.reduce(((r,t)=>r.concat(t)),[]).filter(Boolean),e=0===n.length;if(e&&!config.autoSort)return config.autoWrap?wrapperProxy(r):r;const o=e?[(new Sort).seal()]:n.map(((r,t)=>isFn(r)?r:genSortFnFromStr(r))),i=(a=o,(r,t)=>a.reduce(((n,e)=>n||e(r,t)),0));var a;let s=r.sort(i);return config.autoWrap&&(s[config.patched]||(s=wrapperProxy(s))),s}}const factory=genFactory(),extendPlugs=r=>(Object.entries(r).map((([r,t])=>plugins[r]=t)),factory);factory.extends=extendPlugs,factory.wrap=r=>wrapperProxy(r),factory.config=config,module.exports=factory;

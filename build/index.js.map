{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["type SortableTypeEnum = 'void' | 'string' | 'number' | 'date' | 'symbol' | 'boolean' | 'function'\n\nconst isVoid = (x: any): boolean => x == undefined\nconst isVoidType = (x: SortableTypeEnum): boolean => x === 'void'\nconst getType = (x: any): SortableTypeEnum => isVoid(x) ? 'void' : Object.prototype.toString.call(x).slice(8, -1).toLowerCase()\nconst isFnType = (x: any): boolean => getType(x) === 'function'\n\n// return void to skip sort, by example,\n// [3,2,3].sort((a, b) => null) result in [3,2,3]\ntype SkipCompareValue = void\ntype ComparableValue = string | number | boolean | SkipCompareValue\ntype GetCompareValFn = (x: any) => ComparableValue\n\n// TODO refactor to function: x => comparableValue\n/* get comparable value from specific value */\nconst getCompareValue: ({ [key: string]: GetCompareValFn }) = {\n  string: String,\n  number: Number,\n  date: (x: Date): number => +x,\n  symbol: (x: Symbol): string => x.toString(),\n  // The priority of true is greater than false\n  boolean: (x: any): boolean => !x,\n}\n\ntype Sort = SkipCompareValue | 1 | 0 | -1\ntype SortFn = (a: any, b: any) => Sort\ntype CondSortFn = (type: SortableTypeEnum) => SortFn\n\n/* compare two value by some methods */\nconst by: ({ [key: string]: SortFn | CondSortFn }) = {\n  default (a: any, b: any) {\n    const typeA = getType(a)\n    const typeB = getType(b)\n\n    const onceEmpty = isVoidType(typeA) || isVoidType(typeB)\n    if (onceEmpty) {\n      if (typeA === typeB) return 0\n      return a ? -1 : 1\n    }\n\n    const canSort = getCompareValue[typeA] && typeA === typeB\n    if (!canSort) {\n      console.warn(`[TIP] cannot sort ${a} with ${b}，skip by default`)\n      return undefined\n    }\n\n    // @ts-ignore\n    return by.type(typeA)(a, b)\n  },\n  type: (type: SortableTypeEnum): SortFn => (a: any, b: any): Sort => {\n    const getValFn = getCompareValue[type]\n    if (!getValFn) throw new Error(`[ERR] error occured when compare value ${a} with value ${b}`)\n    const va = getValFn(a), vb = getValFn(b)\n    return va === vb ? 0 : (va < vb ? -1 : 1)\n  }\n}\n\n// Sort Factory\nfunction Sort() {\n  this.compare = null\n  this.pipeline = []\n}\n// 给管道添加解构方法，用于解构对象并处理值\n// @example\n// sort.map(x => String(x.a))\n// 从 x 中取得 a 属性并转换为字符串，再继续比较\nSort.prototype.map = function (_value) {\n  this.pipeline.push({ _value, _type: 'map' })\n  return this\n}\n// 给管道添加插件，用于调整排序动作\n// @example\n// sort.plugin(fn => (a, b) => -fn(a, b))\n// 将上一个排序结果反转\nSort.prototype.plugin = function (_value) {\n  this.pipeline.push({ _value, _type: 'plugin' })\n  return this\n}\n// 设定排序方法，用来处理排序的值的顺序\nSort.prototype.sortby = function (fn) {\n  this.compare = isFnType(fn) ? fn : by.type(fn.toLowerCase())\n}\n// 空过程函数（接受一个函数，返回一个接受参数并返回该函数处理参数的结果的函数）\nconst pass = sortFn => (...args) => sortFn(...args)\n// 将管道合并为函数\nSort.prototype.seal = function () {\n  this.compare = this.compare || by.default\n\n  const plugin = plug => sortFn => (...args) => plug(sortFn(...args))\n  const mapping = map => sortFn => (...args) => sortFn(...args.map(x => map(x)))\n\n  return this.pipeline.reduce((lastSortFn, current) => {\n    const { _type, _value } = current\n    if (_type === 'map') return mapping(lastSortFn(_value))\n    if (_type === 'plugin') return plugin(_value)(lastSortFn)\n  }, pass)(this.compare)\n}\n\n// 初始插件\nconst plugins = {\n  by: (sort, args) => sort.sortby(args),\n  i: sort => sort.map(x => (x || '').toLowerCase()),\n  asc: sort => sort.plugin(pass),\n  dec: sort => sort.plugin(fn => (...args) => -fn(...args)),\n  rand: sort => sort.plugin(() => () => Math.random() < .5 ? -1 : 1),\n  is: (sort, args = '') => sort.map(x => x === args).sortby('boolean'),\n  all: (sort, args = '') => sort.map(x => x.every ? x.every(y => String(y) === args) : x === args).sortby('boolean'),\n  has: (sort, args) => sort.map(x => x.some(y => String(y) === args)).sortby('boolean'),\n  not: (sort, args = '') => sort.map(x => args ? (x !== args) : !x).sortby('boolean'),\n  len: (sort, args = null) => isVoid(args)\n    ? sort.map(x => x.length).sortby('number')\n    : sort.map(x => x.length === args).sortby('boolean'),\n\n  // 默认使用解构插件，处理对象的属性如 'a.b.c' 的值\n  default: name => {\n    const pathsStore = name.split('.')\n    const getVal = x => {\n      const paths = [].concat(pathsStore)\n      let val = x, next = null\n      while (val && paths.length) {\n        next = paths.shift()\n        val = val[next]\n      }\n      return val\n    }\n    return sort => sort.map(getVal)\n  }\n}\n\n// 从字符串指令中得到排序函数\nfunction generate(s) {\n  const sort = new Sort()\n  let [...actions] = s.split('-')\n  actions = actions.filter(x => x)\n    .map(action => {\n      const [all, name, argsWithQuote, args] = action.match(/([^(]+)(\\(([^)]*)\\))?/)\n      const plugin = argsWithQuote\n        ? plugins[name]\n        : plugins.default(name)\n      plugin(sort, args || undefined)\n    })\n  return sort.seal()\n}\n\n/* Main Functions */\n\ntype SortCMD = string | SortFn\n\nfunction factory(...cmd: SortCMD[]): SortFn {\n  cmd = cmd.reduce((h, c) => (h.concat(c)), [])\n  if (cmd.length < 1) return undefined\n\n  const sortFns = cmd.map((x, i) => {\n    try {\n      return isFnType(x) ? x : generate(x)\n    } catch (error) {\n      throw new Error(`Error on generate sort function, Index ${i + 1}th: ${x}.`)\n    }\n  })\n\n  const flat = fns => (a, b) => fns.reduce((sortResult, fn) => sortResult || fn(a, b), 0)\n  return flat(sortFns)\n}\n\n\nfactory.extends = function extendPlugin(exts = {}) {\n  Object.entries(exts).map(([k, v]) => {\n    plugins[k] = v\n  })\n}\n\nmodule.exports = factory\n"],"names":[],"mappings":"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"}